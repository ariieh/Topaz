<% content_for :sidebar do %>
  <%= render "sidebar", view: @view, el: @el %>
<% end %>

<h2><%= @article.title %></h2>
<h3>author: <a href="<%= user_url(@article.author_id) %>"><%= User.find(@article.author_id).username %></a></h3>
<h5><%= @article.created_at %></h5>

<div id="body-text">
  <% body_text = simple_format(h @article.body) %>
  <% body_text.scan("<p>").each_with_index do |p, index| %>
    <% body_text[body_text.index(p)..body_text.index(p)+2] = "<p id=\"#{index +           1}\">" %>
  <% end %>
  
  <%# body_text = body_text.gsub("</p>", "<div class='comment-button'><i class='fa fa-comment'></i></div></p>").html_safe %>

  <%= body_text %>
</div>

<% if signed_in? %>
  <form action="<%= article_comments_url(@article) %>" method="post">
  	<%= auth_token %>
  	<input type="text" name="comment[text]">
  	<input type="submit" value="Add Comment">
  </form>

  <form action="<%= article_votes_url(@article) %>" method="post">
    <%= auth_token %>

    <% if current_user.votes &&
       current_user.votes.map(&:article_id).include?(@article.id) %>
      <input type="submit" value="Favorite" disabled>
    <% else %>
      <input type="submit" value="Favorite">
    <% end %>
  </form>
<% end %>

<% @article.comments.order(:created_at).reverse.each do |comment| %>
	<%= comment.author.username + ": " + comment.text %><br>
<% end %>

<br>

<i class="fa fa-tags"></i>
<% @article.tags.order(:name).each do |tag| %>
	<a href="<%= article_url(tag.articles.order(:created_at).reverse.first,
                    view: "tag", el: tag.name) %>"><%= tag.name%></a>
<% end %>